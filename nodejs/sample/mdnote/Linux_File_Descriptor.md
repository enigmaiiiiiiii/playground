# 文件描述符

- 是一个非负整数
- 伴随着进程产生
- 由进程创建
- 不同进程的相同文件的文件描述符不一定想等
- 打开文件时创建, 文件运行时才有文件描述符
- 一个文件描述符对应一个**打开**的文件
- [进程](进程.md)是通过文件描述符来访问文件的
- 是UNIX类操作系统特有的概念

***

> 例： 用vim打开一个文件`vim test`, `ls -l /proc/test文件的PID/fd`输出如下内容

```bash
lrwx------ 1 user user 0 Sep  9 10:48 0 -> /dev/tty1
lrwx------ 1 user user 0 Sep  9 10:48 1 -> /dev/tty1
lrwx------ 1 user user 0 Sep  9 10:48 2 -> /dev/tty1
lrwx------ 1 user user 0 Sep  9 10:48 4 -> /home/user/code/.test.swn
```

  除系统自动创建的文件描述符外，还有一个编号为4的文件，vim程序会将所有修改都写入该文件

***
  
## 进程表

- 每一个进程有一个进程表
- 每一项包括文件描述符标志和指向一个文件表项的指针
- 文件表项包括：
  - 文件状态标志 
  - 当前文件偏移量 
  - 指向该文件v节点表项的指针
- v-node包含了
  - 文件类型和对此文件进行各种操作函数的指针，  
  - 大多数还包含了该文件的i节点
- i-node
  - i节点包含了文件所有者，文件长度，磁盘位置等信息 
- 由文件描述符组成的数组， 通常记为`fd`
- 每当进程打开一个文件时，为文件指定数组中的一个元素
- 每个进程创建三个标准文件描述符
  - STDIN_FILENO(标准输入，如键盘) 
  - STDOUT_FILENO(标准输出，如显示器) 
  - STDERR_FILENO 
- 默认size上限1024  


## 文件描述符命令

- 创建文件描述符
  - `exec num<file` 创建仅可用于输入的文件描述符
  - `exec num>file` 创建仅可用于输出的文件描述符
  - `&文件描述符`调用文件描述符
  - `exec 文件描述符<&-` 关闭文件描述符
  - `exec 文件描述符>&-` 关闭文件描述符